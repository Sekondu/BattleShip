(()=>{"use strict";class e{constructor(e,t,s,i="human"){this.length=e,this.id=t,this.hits=0,this.direction=s,this.sunk=!1,this.person=i}hit(){this.hits++}isSunk(){return this.length===this.hits&&(this.sunk=!0,!0)}}class t{constructor(){this.game=new Map,this.ai_game=new Map,this.checked=new Set,this.ships_positions=new Map,this.vertical=[1,2,3,4,5,6,7,8,9,10],this.horizontal=["A","B","C","D","E","F","G","H","I","J"],this.horizontal.forEach((e=>{this.vertical.forEach((t=>{this.game.set(`${e}${t}`,null),this.ai_game.set(`${e}${t}`,null)}))}))}place_ship(e,t,s,i){let r="human"===i?this.game:this.ai_game;if("horizontal"===e.direction){let a=this.horizontal.indexOf(t),h=e.length,o=!1;for(;h>0;){if("occupied"===this.get_coordinates(r,`${this.horizontal[a]}${s}`)||void 0===this.horizontal[a]){o=!1;break}h--,o=!0,a++}if(!o)return null;for(h=e.length,a=this.horizontal.indexOf(t);h>0;)"human"!=i&&document.querySelector(".player_grid").querySelector(`.${this.horizontal[a]}${s}`).classList.add("purple"),this.set_coordinates(r,`${this.horizontal[a]}${s}`,"occupied"),this.ships_positions.set(`${r}${this.horizontal[a]}${s}`,e),a++,h--}else{let a=this.vertical.indexOf(s),h=e.length,o=!1;for(;h>0;){if("occupied"===this.get_coordinates(r,`${t}${this.vertical[a]}`)||void 0===this.vertical[a]){o=!1;break}h--,o=!0,a++}if(!o)return null;for(h=e.length,a=this.vertical.indexOf(s);h>0;)"human"!=i&&document.querySelector(".player_grid").querySelector(`.${t}${this.vertical[a]}`).classList.add("purple"),this.set_coordinates(r,`${t}${this.vertical[a]}`,"occupied"),this.ships_positions.set(`${r}${t}${this.vertical[a]}`,e),a++,h--}}get_coordinates(e,t){return e.get(t)}set_coordinates(e,t,s){e.set(t,s)}get_ship_id(e,t){return this.ships_positions.get(`${e}${t}`)}recieved_attack(e,t){let s="human"===t?this.game:this.ai_game;if(null===this.get_coordinates(s,e))return this.set_coordinates(s,e,"miss"),"miss";if("occupied"===this.get_coordinates(s,e)){let s="human"===t?this.game:this.ai_game;return this.set_coordinates(s,e,"hit"),this.get_ship_id(s,e).hit(),"hit"}return null}}class s{constructor(e="human"){this.gameBoard=new t,this.total_ships=[],this.person=e,this.array=Array.from(this.gameBoard.ai_game.keys()),console.log(this.array)}attack(e){if("hit"===this.gameBoard.recieved_attack(e,this.person))return"hit"}create_ships(){this.ship1=new e(4,10,"vertical",this.person),this.ship2=new e(3,11,"vertical",this.person),this.ship3=new e(3,12,"horizontal",this.person),this.ship4=new e(2,20,"horizontal",this.person),this.ship5=new e(2,21,"vertical",this.person),this.ship6=new e(2,22,"horizontal",this.person),this.ship7=new e(1,23,"horizontal",this.person),this.ship8=new e(1,24,"horizontal",this.person),this.ship9=new e(1,25,"horizontal",this.person),this.ship10=new e(1,26,"horizontal",this.person),this.place_ships(this.ship1),this.place_ships(this.ship2),this.place_ships(this.ship3),this.place_ships(this.ship4),this.place_ships(this.ship5),this.place_ships(this.ship6),this.place_ships(this.ship7),this.place_ships(this.ship8),this.place_ships(this.ship9),this.place_ships(this.ship10),this.total_ships=[this.ship1,this.ship2,this.ship3,this.ship4,this.ship5,this.ship6,this.ship7,this.ship8,this.ship9,this.ship10]}place_ships(e){let t=[1,2,3,4,5,6,7,8,9,10],s=["A","B","C","D","E","F","G","H","I","J"],i=Math.floor(9*Math.random()),r=Math.floor(9*Math.random());null===this.gameBoard.place_ship(e,s[i],t[r],this.person)?this.place_ships(e):console.log(`${s[i]}:${t[r]}`)}all_ships_sunk(){let e=0;return this.total_ships.forEach((t=>{t.isSunk()&&e++})),e===this.total_ships.length}get_coord(){let e=Math.floor(Math.random()*this.array.length);if("hit"!==this.gameBoard.get_coordinates(this.gameBoard.ai_game,this.array[e])&&"miss"!==this.gameBoard.get_coordinates(this.gameBoard.ai_game,this.array[e])){let t=this.array[e],s=this.array[e];return this.array[e]=this.array[0],this.array[0]=s,this.array.shift(),t}this.get_coord()}}let i=new s,r=new s("AI"),a=new class{constructor(){this.turn=2,this.vertical=[1,2,3,4,5,6,7,8,9,10],this.horizontal=["A","B","C","D","E","F","G","H","I","J"],this.reset.bind(this),this.start_game.bind(this)}create_player_grid(){let e=document.querySelector(".player_grid"),t=document.querySelector(".computer_grid");for(let s=0;s<10;s++)for(let i=0;i<10;i++){let r=document.createElement("button"),a=document.createElement("button");a.classList.add(`${this.horizontal[i]}${this.vertical[s]}`),r.classList.add(`${this.horizontal[i]}${this.vertical[s]}`),this.add_event_listener(a),this.add_event_listener_player_boxes(r),a.disabled=!0,r.disabled=!0,e.appendChild(r),t.appendChild(a)}}remove_grid(){let e=document.querySelector(".player_grid"),t=document.querySelector(".computer_grid");e.innerHTML="",t.innerHTML=""}add_event_listener(e){e.addEventListener("click",(()=>{let t=e.classList;"hit"===i.attack(t.value)?(e.classList.add("green"),e.style="background-color:green",e.disabled=!0,this.check_winner()):(this.turn++,this.proceed_game(),e.classList.add("red"),e.style="background:red",e.disabled=!0)}))}add_event_listener_player_boxes(e){e.addEventListener("click",(()=>{if(e.classList.contains("purple")){console.log("THIS IS PURPLE"),e.classList.remove("purple"),e.style="background-color:green";let t=e.classList;r.attack(t.value),this.ai_move(),e.disabled=!0,this.check_winner()}else this.turn++,this.proceed_game(),console.log("SAD"),e.style="background-color:red",e.disabled=!0}))}remove_event_listener_player_boxes(e){e.disabled=!0}remove_Event_Listener(e){e.disabled=!0}ai_move(){let e=r.get_coord(),t=document.querySelector(".player_grid"),s=r.attack(e),i=t.querySelector(`.${e}`);i?("hit"===s?(i.classList.add("green"),i.style.backgroundColor="green"):(i.classList.add("red"),i.style.backgroundColor="red"),i.disabled=!0,this.check_winner(),this.turn++,this.proceed_game()):console.error("Box not found for coord:",e)}check_winner(){i.all_ships_sunk()?(document.querySelector("h1").textContent="You Win!",this.add_replay()):r.all_ships_sunk()&&(document.querySelector("h1").textContent="AI Win!",this.add_replay())}add_replay(){let e=document.querySelector(".play_buttons"),t=document.createElement("button");t.classList.add("replay"),t.textContent="Replay",document.querySelector(".replay")||e.appendChild(t),t.addEventListener("click",(()=>this.reset()))}reset(){document.querySelector("h1").textContent="BattleShip";let e=document.querySelector(".replay");e.classList.remove("replay"),e.parentNode.removeChild(e),e.removeEventListener("click",(()=>this.reset())),this.start_game()}start_game(){let e=document.querySelector(".play");e.removeEventListener("click",(()=>{e.disabled=!0,i.create_ships(),this.proceed_game()})),this.remove_grid(),this.create_player_grid(),r.create_ships(),console.log(r.gameBoard.ai_game),e.disabled=!1,e.addEventListener("click",(()=>{e.disabled=!0,this.proceed_game()}))}initial_start(){this.create_player_grid(),r.create_ships(),console.log(r.gameBoard.ai_game);let e=document.querySelector(".play");e.disabled=!1,e.addEventListener("click",(()=>{e.disabled=!0,i.create_ships(),this.proceed_game()}))}proceed_game(){let e=document.querySelectorAll(".computer_grid>*"),t=document.querySelectorAll(".player_grid>*");this.turn%2==0?(e.forEach((e=>{e.classList.contains("red")||e.classList.contains("green")||(e.disabled=!1)})),t.forEach((e=>{e.disabled=!0}))):(e.forEach((e=>{e.disabled=!0})),t.forEach((e=>{e.disabled=!1})),this.ai_move())}};document.addEventListener("DOMContentLoaded",(()=>{a.initial_start()}))})();